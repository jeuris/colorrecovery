$("document").ready(function(){$("a[data-rel]").each(function(){$(this).attr("rel",$(this).data("rel"))});folderpath=$(".maincontent").data("folderpath");PageManager.init();PageEditor.init()});var PageManager={currentSlug:"",currentSlugType:"",init:function(){$("#modalWindow").on("hidden",function(){$(this).removeData("modal")})},loadPage:function(e){$.ajax({type:"GET",url:"http://steiner.dev/api/page/"+e,dataType:"json",data:"",success:function(e){$(".content").empty();for(var t=0;t<e.parts.length;t++)$(".content").append(e.parts[t])},complete:function(e){}})},editCollection:function(e){var t=$(".editcollection").serialize();$.ajax({type:"POST",url:"http://steiner.dev/beheer/api/editmaincollection/"+e,data:t,dataType:"json",complete:function(e){},success:function(e){window.location=window.location},error:function(e){}})},deletePage:function(e){var t=confirm("Deze pagina verwijderen?");if(!t)return!1;window.location="/beheer/page/delete/"+e},populateModal:function(){},linkcreatorSetup:function(e,t){var n=this;$("#linkerList").columnview({onchange:function(e){n.currentSlugType=$(e).data("linktype");n.currentSlug=$(e).data("slug")}});e!=undefined&&t!=undefined&&$("#linkerList").columnview("setOpen",e,t)},linkToExistingPage:function(e,t){var n=this.getLinkAndTypeDivs(e,t);n.slugDiv.html(this.currentSlug);n.typeDiv.html(this.currentSlugType);PageEditor.saveTemplate(e);$("#modalWindow").modal("hide")},linkToNewPage:function(e,t,n,r){var i=this;$.ajax({type:"POST",url:"http://steiner.dev/beheer/api/createnewpage",data:{name:t,pagetemplateid:e},dataType:"json",complete:function(e){},success:function(t){var s=t.slug,o=i.getLinkAndTypeDivs(e,r);o.slugDiv.html(s);o.typeDiv.html(n);i.currentSlugType=n;i.currentSlug=s;PageEditor.saveTemplate(e,PageManager.navigateToCreatedPage);$("#modalWindow").modal("hide")},error:function(e){}})},linkToExternalPage:function(e,t,n){var r=this.getLinkAndTypeDivs(e,t);r.linkDiv.html(n);r.typeDiv.html("external");PageEditor.saveTemplate(e);$("#modalWindow").modal("hide")},getLinkAndTypeDivs:function(e,t){var n=new Object;$itemholder=$("#template-"+e+' .template-itemholder [data-key="slug"]');if($itemholder.length>0)$itemholder.each(function(){if($itemholder.index(this)==t){$slugDiv=$(this);$typeDiv=$(this).parents(".template-item").find('[data-key="typeSlug"]');n.slugDiv=$slugDiv;n.typeDiv=$typeDiv}});else{n.slugDiv=$("#template-"+e+' [data-key="slug"]');n.typeDiv=$("#template-"+e+' [data-key="typeSlug"]')}return n},linkToPage:function(){},navigateToCreatedPage:function(){$.ajax({type:"POST",url:"http://steiner.dev/beheer/api/pagebyslugandtype",data:{slug:PageManager.currentSlug,type:PageManager.currentSlugType},dataType:"json",complete:function(e){},success:function(e){window.location="/beheer/page/edit/"+e.page},error:function(e){}})}},PageEditor={ready:!1,page_id:"",init:function(e){var t=this;this.page_id=$(".page_editor").data("pageid");$("#sortable").length>0&&$("#sortable").sortable({handle:".label"});if($("#sortable2").length>0){$("#sortable2").sortable({handle:".label"});$("#sortable2 .label").unbind("click").click(function(e){e.stopPropagation();var t=$(this),n=t.find(".showcnt"),r=t.parents("li").find(".details");if(!r.is(":visible")){r.slideDown();n.removeClass("icon-arrow-down").addClass("icon-arrow-up")}else{r.slideUp();n.removeClass("icon-arrow-up").addClass("icon-arrow-down")}})}$("#sortable2").unbind("sortstop").bind("sortstop",function(e){var t=[];$(".page_editor .sortitem").each(function(e){var n=$(this).attr("id").split("-")[1],r=$(".page_editor .sortitem").index(this);t[r]=n});$.ajax({type:"POST",url:"http://steiner.dev/beheer/api/updatetemplatesorting",data:{positions:t},dataType:"json",complete:function(e){},success:function(e){},error:function(e){}})});$('[data-editable="true"]').unbind().click(function(e){$(this).attr("contentEditable","true");$("#sortable2").sortable("disable");$(".template-itemholder").sortable().sortable("disable");this.removeEventListener("input");this.addEventListener("input",function(e){$(this).attr("data-changed","true")},!1);this.removeEventListener("paste");this.addEventListener("paste",function(e){var t=e.target;setTimeout(function(){$(t).html($(t).text())},1)});$(this).blur(function(e){$("#sortable2").sortable("enable");$(".template-itemholder").sortable("disable")});$(this).unbind("keydown");$(this).keydown(function(e){if(e.which==13){e.preventDefault();if(window.getSelection){var t=window.getSelection();if(t.getRangeAt&&t.rangeCount){var n=document.createElement("br"),r=t.getRangeAt(0);r.insertNode(n);r.setStartAfter(n);r.collapse(!0);t.removeAllRanges();t.addRange(r)}}else document.selection&&document.selection.createRange&&document.selection.createRange().pasteHTML("<br/>")}});$(this).focus()});$("[data-key].hidden").each(function(){$(this).attr("style","");$(this).removeClass("hidden");$(this).data("description")&&$(this).before('<div class="field-description">'+$(this).data("description")+"</div>")});$('[data-editable="select"]').each(function(){var e,t,n;n=$(this).data("value");t=$(this).data("select").split("|");e="<select>";for(var r=0;r<t.length;r++){e+='<option value="'+t[r]+'"';t[r]===n&&(e+=" selected");e+=">"+t[r]+"</option>"}e+="</select>";$(this).html(e)});$('div[id^="mediaplayer-"]').each(function(){var e=$(this).attr("id");e.indexOf("_wrapper")<0&&jwplayer(e).setup({flashplayer:"/assets/jwplayer/jwplayer.flash.swf",width:"100%",height:400,file:$(this).data("url"),controlbar:"bottom"})});$(".template-itemholder .template-item").each(function(){var e=$(this).find('[data-key="image"]').html(),n=$(".template-itemholder .template-item").index(this);$(this).find(".remove-item").length<1&&$(this).append('<a class="btn remove-item"><i class="icon icon-remove"></i></a>');$(this).parents(".details").find(".footerbar").removeClass("hidden");$(".addtemplateitem").unbind().click(function(e){e.stopPropagation();var n=$(e.target.parentNode).data("templateid");t.addTemplateItem(n)});$(".remove-item").unbind("click").click(function(e){e.stopPropagation();var t=$(e.target).parents(".template-itemholder").find(".template-item").length;if(t>1){var n=confirm("Dit gedeelte verwijderen?");if(n){var r=$(e.target).parents(".template-item").filter(":first"),i=$(r).find('[data-key="slug"]').html(),s=$(r).parents(".template-itemholder").filter(":first"),o=$(r).parents(".sortitem").attr("id").substr(9),u=0;$(s).find(".template-item").each(function(e){this===r[0]&&$.ajax({type:"POST",url:"http://steiner.dev/beheer/api/removetemplateitem/"+o+"/"+u,data:"",dataType:"json",complete:function(e){},success:function(e){$(r).animate({opacity:0,height:0},500,function(){$(this).remove()})},error:function(e){}});u++})}}});$(this).unbind().mouseover(function(e){$("#sortable2").sortable("disable");$(".template-itemholder").sortable({items:".template-item"}).sortable("enable").unbind("sortstop").bind("sortstop",function(){if($(this).find(".main_image").length>1)var e=$(this).find('[data-key="slug"]').html()});$(this).mouseout(function(e){$("#sortable2").sortable("enable");$(".template-itemholder").sortable("disable")})})});$(".sortitem").each(function(){itemIndex=0;$(this).find('[data-key="slug"]').each(function(){var e=$(this).parents(".sortitem").attr("id").substr(9);$(this.parentNode).find(".sluglink").length||$(this).after('<a class="sluglink btn" href="/beheer/modal/linkcreator/'+e+"/"+itemIndex+'"'+' role="button" data-toggle="modal" data-target="#modalWindow"><i class="icon-arrow-right"></i></a>');$(this).html()!=""&&$(this).parent().find(".follow-item").length<1&&$(this).parent().append('<a class="btn follow-item"><i class="icon icon-chevron-right"></i></a>');itemIndex++})});$(".follow-item").unbind().click(function(e){e.stopPropagation();var t=$(e.target).parents(".template-item").filter(":first");if(t.length==0){var n=$(e.target).parents(".sortitem").attr("id").substr(9),r=-1;$.ajax({type:"GET",url:"http://steiner.dev/beheer/api/pagebyitem/"+n+"/"+r,data:"",dataType:"json",cache:!1,complete:function(e){},success:function(e){window.location="/beheer/page/edit/"+e.page},error:function(e){}})}else{var i=$(t).parents(".template-itemholder").filter(":first"),n=$(t).parents(".sortitem").attr("id").substr(9),r=0;$(i).find(".template-item").each(function(){this===t[0]&&$.ajax({type:"GET",url:"http://steiner.dev/beheer/api/pagebyitem/"+n+"/"+r,data:"",dataType:"json",cache:!1,complete:function(e){},success:function(e){window.location="/beheer/page/edit/"+e.page},error:function(e){}});r++})}});$('[data-key="image_id"]').each(function(){$(this).attr("style","display:none");if($(this).attr("id")){var e=-1,t=$(this).attr("id").substr(14),n=$(this).html();$(this).parents(".template-itemholder").length>0&&(e=$("#template-"+t+' .preview [data-key="image_id"]').index(this));$(this.parentNode).find(".croplink").length?$(this.parentNode).find(".croplink").attr("href","/beheer/modal/imagecropper/"+n+"/"+t+"/"+e):$(this).after('<a class="croplink btn" href="/beheer/modal/imagecropper/'+n+"/"+t+"/"+e+'" role="button" data-toggle="modal" data-target="#modalWindow"><i class="icon icon-picture"></i></a>')}});$(".navbar .savebtn").unbind("click").click(function(e){e.stopPropagation();var n=$(e.target).parents("li.sortitem");n=$(n).attr("id").substr(9);t.saveTemplate(n)});$(".navbar .deletebtn").unbind("click").click(function(e){e.stopPropagation();var n=$(e.target).parents("li.sortitem");n=$(n).attr("id").substr(9);t.deleteTemplate(n)});$('[data-key="pagination"]').each(function(){var e,t,n,r,i;t=0;n=0;r='<div class="page">';i=parseInt($(this).data("value"),10);e=$(this).parent().find(".template-itemholder");e.find(".template-item").each(function(){if(t===i){n++;t=0;r+='</div><div class="page">'}else t++;r+=$(this).clone()});r+="</div>";e.html(r)});this.ready=!0},addTemplate:function(e){var t=this,n=$(e).data("page"),r=$(e).data("template");$.ajax({type:"POST",url:"http://steiner.dev/beheer/api/addtemplate",data:"page_id="+n+"&template_id="+r,dataType:"json",success:function(e){var n=$(".page_editor .sortitem:first-child").clone();$(n).addClass("new-item");$(n).attr("id","template-"+e.template_id);$(n).find(".label").html('<span class="icon-align-justify"></span><span class="showcnt icon-arrow-down"></span>'+e.template_name);$(n).find(".btn-group").attr("data-templateid",e.template_id);$(n).find(".preview").html(e.html);$("#sortable2").append(n).sortable("refresh");$("#modalWindow").modal("hide");$(".new-item .label").click();t.init()},error:function(e){},complete:function(e){}})},addTemplateItem:function(e){var t=$("#template-"+e+" .template-item:first").clone();t.addClass("new-template");t.find('[data-key="image_id"]').html("-1");t.find('[data-key="slug"]').html("");$("#template-"+e+" .template-itemholder").append(t);$(".new-template").animate({opacity:1},500,function(){$(".new-template").removeClass("new-template")});this.init()},saveTemplate:function(e,t){var n=0,r=0,i=this,s="",o=$("#template-"+e+" .template-item");$('[data-editable="select"]').each(function(){var e;e=$(this).find("select").attr("value");$(this).data("value",e);$(this).html(e)});if(o.length>0){s+="&itemcount="+o.length;$("li#template-"+e+" .preview [data-editable]").each(function(){if(!$(this).parents(".template-itemholder").length){var e=$(this).data("key"),t=$(this).html();s+="&"+e+"="+t}});$(o).each(function(){n++;var e=$(this).find("[data-editable]");e.each(function(){var e=$(this).data("key"),t=$(this).html();s+="&item"+n+"-"+e+"="+t})})}else $("li#template-"+e+" [data-editable]").each(function(){var e=$(this).data("key"),t=$(this).html();s+="&"+e+"="+t});var u=$("li#template-"+e).parents(".sortitem");$.ajax({type:"POST",url:"http://steiner.dev/beheer/api/savetemplate/"+e+"/"+i.page_id,data:s,dataType:"json",complete:function(e){},success:function(r){$("li#template-"+e+' [data-key="slug"]').each(function(){var t=$("li#template-"+e+' [data-key="slug"]').index(this);r&&r.slugs&&$(this).html(r.slugs[t])});if(r&&r.data){var i=r.data;if(i.items){var s=$("li#template-"+e).find(".template-item");for(n=0;n<s.length;n++){var o=$(s[n]).find('[data-key="id"]'),u=$(s[n]).find('[data-key="slug"]'),a=i.items[n];if(a.old_slug==$(u).html()){$(u).html(a.slug);$(o).html(a.id)}}}}$("li#template-"+e+" .savebtn").addClass("btn-success",{duration:500});setTimeout(function(){$("li#template-"+e+" .savebtn").removeClass("btn-success")},3e3);t!=undefined&&t()},error:function(t){$("li#template-"+e+" .savebtn").addClass("btn-danger",{duration:500});setTimeout(function(){$("li#template-"+e+" .savebtn").removeClass("btn-danger")},3e3)}});this.init()},deleteTemplate:function(e){if($(".sortitem").length>1){var t=confirm("Dit gedeelte verwijderen?");t&&$.ajax({type:"POST",url:"http://steiner.dev/beheer/api/deletetemplate/"+e,data:"",dataType:"json",complete:function(e){},success:function(t){$("li#template-"+e).animate({opacity:0,height:0},400,function(){$(this).remove()})},error:function(e){}})}},addNewImage:function(e){},editExistingImage:function(e){$.ajax({type:"POST",url:"http://steiner.dev/beheer/api/editExistingImage",data:e,dataType:"json",complete:function(e){},success:function(e){$("#modalWindow").modal("hide")},error:function(e){}})}};