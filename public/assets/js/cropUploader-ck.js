var CropUploader={jcrop_api:null,x1:0,x2:0,y1:0,y2:0,w:0,h:0,boxWidth:560,boxHeight:500,url:"",imagePath:"",fullWidth:0,fullHeight:0,thumbWidth:0,thumbHeight:0,selectCropWidth:0,selectCropHeight:0,template_id:0,item_id:0,image_id:0,realImageWidth:0,realImageHeight:0,jsonConfig:"{}",init:function(e){var t=this;this.url=e.url;this.fullWidth=e.fullWidth;this.fullHeight=e.fullHeight;this.thumbWidth=e.thumbWidth;this.thumbHeight=e.thumbHeight;this.selectCropWidth=e.selectCropWidth;this.selectCropHeight=e.selectCropHeight;this.template_id=e.template_id;this.item_id=e.item_id;this.image_id=e.image_id;this.imagePath=e.filepath+e.url;$("#modalWindow .modal-body").empty();var n=$("<img src='"+t.imagePath+"' id='target'/>").on("load",function(){function u(e){t.x1=e.x;t.y1=e.y;t.x2=e.x2;t.y2=e.y2;t.w=e.w;t.h=e.h}t.realImageWidth=this.width;t.realImageHeight=this.height;$("#modalWindow .modal-body").append(n);$("#modalWindow .modal-body").append('<div class="modal-footer"><button data-dismiss="modal" class="btn">Close</button><button class="btn btn-primary" onClick="CropUploader.editExistingImage();">Save changes</button></div>');var e=Math.max($("#target").width(),t.realImageWidth),r=Math.max($("#target").height(),t.realImageHeight),i=Math.max(t.boxHeight,r),s=0,o=0;t.selectCropWidth=t.fullWidth*t.boxWidth/e;t.selectCropHeight=t.fullHeight*i/r;jQuery(function(e){e("#target").Jcrop({setSelect:[0,0,400,400],boxWidth:t.boxWidth,boxHeight:t.boxHeight,aspectRatio:t.fullWidth/t.fullHeight,onChange:u,allowResize:!0},function(){jcrop_api=this})})})},editExistingImage:function(){var e=this,t={x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,fullWidth:this.fullWidth,fullHeight:this.fullHeight,thumbWidth:this.thumbWidth,thumbHeight:this.thumbHeight,url:this.url,image_id:this.image_id,template_id:this.template_id,item_id:this.item_id};$.ajax({type:"POST",url:"http://steiner.dev/beheer/api/editExistingImage",data:t,dataType:"json",complete:function(e){},success:function(t){console.log(e);$("#modalWindow").modal("hide")},error:function(e){console.log(e)}})},setupUpload:function(e){this.jsonConfig=e;var t=this;$(".fileuploader").change(function(){var e=$(this).get(0).files[0];t.uploadFile(e)})},uploadFile:function(e){var t=new FormData,n=this;if(t){t.append("image",e);t.append("image_id",this.jsonConfig.image_id);t.append("template_id",this.jsonConfig.template_id);t.append("item_id",this.jsonConfig.item_id);$.ajax({url:"http://steiner.dev/beheer/api/addnewimage",dataType:"json",type:"POST",data:t,processData:!1,contentType:!1,success:function(e){var t=e.images[0],r=t.saved_as,i=folderpath+"files/temp/",s={filepath:i,url:r,fullWidth:n.jsonConfig.fullWidth,fullHeight:n.jsonConfig.fullHeight,thumbWidth:n.jsonConfig.thumbWidth,thumbHeight:n.jsonConfig.thumbHeight,selectCropWidth:400,selectCropHeight:400,template_id:n.jsonConfig.template_id,item_id:n.jsonConfig.item_id,image_id:e.image_id},o=JSON.stringify(s);CropUploader.init(s)},error:function(e){console.log(e)}})}else alert("afbeelding kan niet worden geupload, neem contact op met MXA.")}};